# 技术实现

## I 信息录入

### 1. txt录入

流式读入。

```cpp
QTextStream in(&file);
QString info = in.readAll();
```

### 2. PDF录入

### 3. JPG/PNG录入

### 4. DOXC录入


## II 个人信息解析

`parserInfo.cpp` 实现了所有个人信息解析的函数，定义在命名空间 `parser` 中。

### 1. 姓名解析

使用Cmss实体识别接口，提取其中type为 `PER` 的word。

```cpp
QJsonValue itemsValue = entityJson["body"]["items"];
QJsonArray itemsArray = itemsValue.toArray();
for (int j = 0; j < itemsArray.count(); ++j) {
    QJsonArray nerTokens = itemsArray.at(j)["nerTokens"].toArray();
    for (int k = 0; k < nerTokens.count(); ++k) {
        if (nerTokens.at(k)["type"].toString().contains("PER")) {
            return nerTokens.at(k)["word"].toString();
        }
    }
}
```

### 2. 年龄

使用正则表达式匹配。

```cpp
const QRegularExpression directRegExp(R"((\d+)\s*(岁|周岁))");
const QRegularExpression indirectRegExp(R"(\d{4}(?:\.|年|/|、))");
const QRegularExpression invalidRegExp(R"([1-5][8-9]|[2-5][0-9]|[6][0-5])");
```

### 3. 学历

使用字典搜索学历。

```cpp
QStringList educationList = { "博士", "硕士", "本科", "学士", "大专", "专科", "中专", "职业学院", "职业学校" , "职业技术学院", "职业技术学校", "高中"};
QString highestEducation = "unknown";

QString removeSpaceContent = content;
removeSpaceContent.replace(" ", "");
for (const auto& education : educationList) {
    if (removeSpaceContent.contains(education)) {
        if (education == "职业学院" || education == "职业学校" || education == "大专" || 
            education == "职业技术学校" || education == "职业技术学院") {
            highestEducation = "专科";
        }
        else if (education == "学士") {
            highestEducation = "本科";
        }
        else {
            highestEducation = education;
        }
        break;
    }
}
```

### 4. 毕业院校

使用Cmss实体识别接口，提取其中type为 `ORG` 的word。

```cpp
QJsonValue itemsValue = entityJson["body"]["items"];
QJsonArray itemsArray = itemsValue.toArray();
for (int j = 0; j < itemsArray.count(); ++j) {
    QJsonArray nerTokens = itemsArray.at(j)["nerTokens"].toArray();
    for (int k = 0; k < nerTokens.count(); ++k) {
        if (nerTokens.at(k)["type"].toString().contains("ORG")) {
            QString org = nerTokens.at(k)["word"].toString();
            if (org.contains("大学") || 
                org.contains("学院") ||
                org.contains("学校")) {
                return org;
            }
        }
    }
}
```

### 5. 工作年限

使用正则表达式匹配时间段，计算时间间隔总和。

```cpp
const QRegularExpression directRegex(
    R"([^\d](\d){1,2}(?:年.*?(?!实习)经(验|历)))"
);
```

```cpp
long long years = 0;
foreach(const auto & interval, intervals) {
    const QDate start = interval.first;
    const QDate end = interval.second;
    const auto count = start.daysTo(end) / 365ll;
    if (count > 0 && count < 40)
        years += count;
}
```

```cpp
const auto years =
    parserWorkYearsHelper(removeSpaceContent,
        QRegularExpression(R"((\d{4}(?:.|年|/|、)\d{1,2})(?:-|–|到|至)(\d{4}(?:.|年|/|、)\d{1,2}))"))
    +
    parserWorkYearsHelper(removeSpaceContent,
        QRegularExpression(R"((\d{4}(?:.|年|/|、)\d{1,2})(?:-|–|到|至)?(至今))"))
    +
    parserWorkYearsHelper(removeSpaceContent,
        QRegularExpression(R"((\d{4})(?:.|年)?(?:-|–|到|至)(\d{4})(?:.|年)?)"))
    +
    parserWorkYearsHelper(removeSpaceContent,
        QRegularExpression(R"((\d{4})(?:.|年)?(?:-|–|到|至)?(至今))"));
```

## III 全部信息解析

## IV 人岗匹配